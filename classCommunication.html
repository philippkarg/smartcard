<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ATmega644 Smart-Card: Communication Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom-doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ATmega644 Smart-Card
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="classCommunication-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Communication Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class that implements the communication protocol between the SmartCard &amp; the Terminal.  
 <a href="classCommunication.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="communication_8h_source.html">communication.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for Communication:</div>
<div class="dyncontent">
<div class="center"><img src="classCommunication__coll__graph.png" border="0" usemap="#Communication_coll__map" alt="Collaboration graph"/></div>
<map name="Communication_coll__map" id="Communication_coll__map">
<area shape="rect" title="Class that implements the communication protocol between the SmartCard &amp; the Terminal." alt="" coords="5,219,196,619"/>
<area shape="rect" href="classLogger.html" title="Logger class that outputs logs over USART." alt="" coords="38,5,163,156"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication_1_1IOPin.html">IOPin</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class that provides functionality for the ATmega644's PinB6, such as an ISR.  <a href="classCommunication_1_1IOPin.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication_1_1Timer.html">Timer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Class that provides functionality for the ATmega644's on-board 16-bit timer, such as an ISR.  <a href="classCommunication_1_1Timer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a88aa7a2d2ac5202e2b8eef787d1a8689"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a88aa7a2d2ac5202e2b8eef787d1a8689">Communication</a> ()</td></tr>
<tr class="memdesc:a88aa7a2d2ac5202e2b8eef787d1a8689"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a new <a class="el" href="classCommunication.html" title="Class that implements the communication protocol between the SmartCard &amp; the Terminal.">Communication</a> object.  <a href="classCommunication.html#a88aa7a2d2ac5202e2b8eef787d1a8689">More...</a><br /></td></tr>
<tr class="separator:a88aa7a2d2ac5202e2b8eef787d1a8689"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab53c6edcc0b9a2daf6950fcd0fc2db58"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#ab53c6edcc0b9a2daf6950fcd0fc2db58">sendATR</a> ()</td></tr>
<tr class="memdesc:ab53c6edcc0b9a2daf6950fcd0fc2db58"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send the Answer-To-Reset sequence to the Terminal.  <a href="classCommunication.html#ab53c6edcc0b9a2daf6950fcd0fc2db58">More...</a><br /></td></tr>
<tr class="separator:ab53c6edcc0b9a2daf6950fcd0fc2db58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb7e7185a93d4e683283f79a1ff05940"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#aeb7e7185a93d4e683283f79a1ff05940">receiveDataToDecrypt</a> (byte_t *data)</td></tr>
<tr class="memdesc:aeb7e7185a93d4e683283f79a1ff05940"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive data to decrypt from the Terminal.  <a href="classCommunication.html#aeb7e7185a93d4e683283f79a1ff05940">More...</a><br /></td></tr>
<tr class="separator:aeb7e7185a93d4e683283f79a1ff05940"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d634219b224e9dbd6cc930d9a92ffd2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a0d634219b224e9dbd6cc930d9a92ffd2">sendDecryptedData</a> (const byte_t *data)</td></tr>
<tr class="memdesc:a0d634219b224e9dbd6cc930d9a92ffd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send the decrypted data to the Terminal.  <a href="classCommunication.html#a0d634219b224e9dbd6cc930d9a92ffd2">More...</a><br /></td></tr>
<tr class="separator:a0d634219b224e9dbd6cc930d9a92ffd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:ac9781e15d4a356d34a02feecc8c1515a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#ac9781e15d4a356d34a02feecc8c1515a">sendBit</a> (const bit_t bit)</td></tr>
<tr class="memdesc:ac9781e15d4a356d34a02feecc8c1515a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a single <code>bit</code> to the Terminal.  <a href="classCommunication.html#ac9781e15d4a356d34a02feecc8c1515a">More...</a><br /></td></tr>
<tr class="separator:ac9781e15d4a356d34a02feecc8c1515a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afee1d50aa5768c3d1e06ce1f57b8e44f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#afee1d50aa5768c3d1e06ce1f57b8e44f">sendByte</a> (const byte_t byte)</td></tr>
<tr class="memdesc:afee1d50aa5768c3d1e06ce1f57b8e44f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a single <code>byte</code> to the Terminal.  <a href="classCommunication.html#afee1d50aa5768c3d1e06ce1f57b8e44f">More...</a><br /></td></tr>
<tr class="separator:afee1d50aa5768c3d1e06ce1f57b8e44f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4938d06e3b4f50f486f8e778cd8e4a2d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a4938d06e3b4f50f486f8e778cd8e4a2d">sendBytes</a> (const byte_t *bytes, const uint8_t len)</td></tr>
<tr class="memdesc:a4938d06e3b4f50f486f8e778cd8e4a2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send an array of <code>bytes</code> byte by byte.  <a href="classCommunication.html#a4938d06e3b4f50f486f8e778cd8e4a2d">More...</a><br /></td></tr>
<tr class="separator:a4938d06e3b4f50f486f8e778cd8e4a2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43cc003e21973368bf52ee6b21f5f26a"><td class="memItemLeft" align="right" valign="top">byte_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a43cc003e21973368bf52ee6b21f5f26a">receiveByte</a> ()</td></tr>
<tr class="memdesc:a43cc003e21973368bf52ee6b21f5f26a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive a single byte from the Terminal.  <a href="classCommunication.html#a43cc003e21973368bf52ee6b21f5f26a">More...</a><br /></td></tr>
<tr class="separator:a43cc003e21973368bf52ee6b21f5f26a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad19417b90a477e7e37716d3a673ca2de"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#ad19417b90a477e7e37716d3a673ca2de">receiveProtocolHeader</a> (const byte_t *header)</td></tr>
<tr class="memdesc:ad19417b90a477e7e37716d3a673ca2de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive a protocol header, which contains 5 bytes.  <a href="classCommunication.html#ad19417b90a477e7e37716d3a673ca2de">More...</a><br /></td></tr>
<tr class="separator:ad19417b90a477e7e37716d3a673ca2de"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:a530448e23dae916c63f5f82b5902e265"><td class="memItemLeft" align="right" valign="top">static bit_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a530448e23dae916c63f5f82b5902e265">sampleBit</a> ()</td></tr>
<tr class="memdesc:a530448e23dae916c63f5f82b5902e265"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sample the <a class="el" href="classCommunication_1_1IOPin.html" title="Class that provides functionality for the ATmega644&#39;s PinB6, such as an ISR.">IOPin</a> 3-times for a more reliable result.  <a href="classCommunication.html#a530448e23dae916c63f5f82b5902e265">More...</a><br /></td></tr>
<tr class="separator:a530448e23dae916c63f5f82b5902e265"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef01d966bfe59d20e8c14bdd551bde2f"><td class="memItemLeft" align="right" valign="top">static bit_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#aef01d966bfe59d20e8c14bdd551bde2f">getParity</a> (byte_t byte)</td></tr>
<tr class="memdesc:aef01d966bfe59d20e8c14bdd551bde2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the parity of a <code>byte</code>.  <a href="classCommunication.html#aef01d966bfe59d20e8c14bdd551bde2f">More...</a><br /></td></tr>
<tr class="separator:aef01d966bfe59d20e8c14bdd551bde2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:aafe3874a776bb7f360ed844e778e20e4"><td class="memItemLeft" align="right" valign="top"><a id="aafe3874a776bb7f360ed844e778e20e4"></a>
friend&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#aafe3874a776bb7f360ed844e778e20e4">Timer</a></td></tr>
<tr class="memdesc:aafe3874a776bb7f360ed844e778e20e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">16-bit Timer/Counter <br /></td></tr>
<tr class="separator:aafe3874a776bb7f360ed844e778e20e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a027e15175d2a6e42992a0007871aba37"><td class="memItemLeft" align="right" valign="top"><a id="a027e15175d2a6e42992a0007871aba37"></a>
friend&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a027e15175d2a6e42992a0007871aba37">IOPin</a></td></tr>
<tr class="memdesc:a027e15175d2a6e42992a0007871aba37"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classCommunication_1_1IOPin.html" title="Class that provides functionality for the ATmega644&#39;s PinB6, such as an ISR.">IOPin</a> (PinB6) <br /></td></tr>
<tr class="separator:a027e15175d2a6e42992a0007871aba37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a87c8e474021b67fe13e08a23d7a67518"><td class="memItemLeft" align="right" valign="top"><a id="a87c8e474021b67fe13e08a23d7a67518"></a>
<a class="el" href="classLogger.html">Logger</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a87c8e474021b67fe13e08a23d7a67518">mLog</a></td></tr>
<tr class="memdesc:a87c8e474021b67fe13e08a23d7a67518"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="classLogger.html" title="Logger class that outputs logs over USART.">Logger</a>. <br /></td></tr>
<tr class="separator:a87c8e474021b67fe13e08a23d7a67518"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92f06f7721a94e6a75ec08107b3e205d"><td class="memItemLeft" align="right" valign="top"><a id="a92f06f7721a94e6a75ec08107b3e205d"></a>
volatile PinDir&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a92f06f7721a94e6a75ec08107b3e205d">mDirection</a> = PinDir::OUTPUT</td></tr>
<tr class="memdesc:a92f06f7721a94e6a75ec08107b3e205d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current direction of the <a class="el" href="classCommunication_1_1IOPin.html" title="Class that provides functionality for the ATmega644&#39;s PinB6, such as an ISR.">IOPin</a>. <br /></td></tr>
<tr class="separator:a92f06f7721a94e6a75ec08107b3e205d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac36a86c65f19bbac545e4351df3b0bff"><td class="memItemLeft" align="right" valign="top"><a id="ac36a86c65f19bbac545e4351df3b0bff"></a>
volatile bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#ac36a86c65f19bbac545e4351df3b0bff">mBitSent</a> = true</td></tr>
<tr class="memdesc:ac36a86c65f19bbac545e4351df3b0bff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether the last bit of a transmission was sent. <br /></td></tr>
<tr class="separator:ac36a86c65f19bbac545e4351df3b0bff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acbde0b115b5640cd61be4f4fb66ede23"><td class="memItemLeft" align="right" valign="top"><a id="acbde0b115b5640cd61be4f4fb66ede23"></a>
volatile bit_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#acbde0b115b5640cd61be4f4fb66ede23">mOutputBit</a> = 0</td></tr>
<tr class="memdesc:acbde0b115b5640cd61be4f4fb66ede23"><td class="mdescLeft">&#160;</td><td class="mdescRight">The next bit to output. <br /></td></tr>
<tr class="separator:acbde0b115b5640cd61be4f4fb66ede23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa15f1c7805859e5e30e6dfa44fee4823"><td class="memItemLeft" align="right" valign="top"><a id="aa15f1c7805859e5e30e6dfa44fee4823"></a>
volatile bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#aa15f1c7805859e5e30e6dfa44fee4823">mByteReceived</a> = 0</td></tr>
<tr class="memdesc:aa15f1c7805859e5e30e6dfa44fee4823"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether a byte was received successfully. <br /></td></tr>
<tr class="separator:aa15f1c7805859e5e30e6dfa44fee4823"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae44c45761cc5c171d9789c2f61cfbb5f"><td class="memItemLeft" align="right" valign="top"><a id="ae44c45761cc5c171d9789c2f61cfbb5f"></a>
volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#ae44c45761cc5c171d9789c2f61cfbb5f">mInputBitCounter</a> = 0</td></tr>
<tr class="memdesc:ae44c45761cc5c171d9789c2f61cfbb5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of input bits in the current transfer. <br /></td></tr>
<tr class="separator:ae44c45761cc5c171d9789c2f61cfbb5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8093edbbdd1fbada1af91678b953ab1c"><td class="memItemLeft" align="right" valign="top"><a id="a8093edbbdd1fbada1af91678b953ab1c"></a>
volatile byte_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a8093edbbdd1fbada1af91678b953ab1c">mInputByte</a> = 0x00</td></tr>
<tr class="memdesc:a8093edbbdd1fbada1af91678b953ab1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">The currently received input byte. <br /></td></tr>
<tr class="separator:a8093edbbdd1fbada1af91678b953ab1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9733a6c88a5fd4eba5f4c79608275e1f"><td class="memItemLeft" align="right" valign="top"><a id="a9733a6c88a5fd4eba5f4c79608275e1f"></a>
volatile bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a9733a6c88a5fd4eba5f4c79608275e1f">mCheckErrors</a> = false</td></tr>
<tr class="memdesc:a9733a6c88a5fd4eba5f4c79608275e1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether to check for errors after sending a byte. <br /></td></tr>
<tr class="separator:a9733a6c88a5fd4eba5f4c79608275e1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84b907dd2fb6d7adfc2b0f6cd59e2cb6"><td class="memItemLeft" align="right" valign="top"><a id="a84b907dd2fb6d7adfc2b0f6cd59e2cb6"></a>
volatile bit_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a84b907dd2fb6d7adfc2b0f6cd59e2cb6">mErrorBit</a> = 0</td></tr>
<tr class="memdesc:a84b907dd2fb6d7adfc2b0f6cd59e2cb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Error bit that is set to 0/1 during the stop bit indicating failure/success. <br /></td></tr>
<tr class="separator:a84b907dd2fb6d7adfc2b0f6cd59e2cb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a174418b3f2d58b7c71a71a5c099372d5"><td class="memItemLeft" align="right" valign="top"><a id="a174418b3f2d58b7c71a71a5c099372d5"></a>
volatile bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a174418b3f2d58b7c71a71a5c099372d5">mParityError</a> = false</td></tr>
<tr class="memdesc:a174418b3f2d58b7c71a71a5c099372d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Whether a parity error occurred while receiving a byte. <br /></td></tr>
<tr class="separator:a174418b3f2d58b7c71a71a5c099372d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a0bb3e5432a3a6d32bb7271b9baeade93"><td class="memItemLeft" align="right" valign="top"><a id="a0bb3e5432a3a6d32bb7271b9baeade93"></a>
static constexpr bit_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#a0bb3e5432a3a6d32bb7271b9baeade93">START_BIT</a> = 0</td></tr>
<tr class="memdesc:a0bb3e5432a3a6d32bb7271b9baeade93"><td class="mdescLeft">&#160;</td><td class="mdescRight">The start bit of a transfer. <br /></td></tr>
<tr class="separator:a0bb3e5432a3a6d32bb7271b9baeade93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea93e4f68298850c1e7c633360367f5c"><td class="memItemLeft" align="right" valign="top"><a id="aea93e4f68298850c1e7c633360367f5c"></a>
static constexpr bit_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCommunication.html#aea93e4f68298850c1e7c633360367f5c">STOP_BIT</a> = 1</td></tr>
<tr class="memdesc:aea93e4f68298850c1e7c633360367f5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">The stop bit of a transfer. <br /></td></tr>
<tr class="separator:aea93e4f68298850c1e7c633360367f5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class that implements the communication protocol between the SmartCard &amp; the Terminal. </p>
<dl class="section author"><dt>Authors</dt><dd>Philipp Karg (<a href="#" onclick="location.href='mai'+'lto:'+'phi'+'li'+'pp.'+'ka'+'rg@'+'tu'+'m.d'+'e'; return false;">phili<span style="display: none;">.nosp@m.</span>pp.k<span style="display: none;">.nosp@m.</span>arg@t<span style="display: none;">.nosp@m.</span>um.d<span style="display: none;">.nosp@m.</span>e</a>)</dd></dl>
<dl class="section date"><dt>Date</dt><dd>05.06.2022 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Philipp Karg 2022 </dd></dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a88aa7a2d2ac5202e2b8eef787d1a8689"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88aa7a2d2ac5202e2b8eef787d1a8689">&#9670;&nbsp;</a></span>Communication()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Communication::Communication </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct a new <a class="el" href="classCommunication.html" title="Class that implements the communication protocol between the SmartCard &amp; the Terminal.">Communication</a> object. </p>
<p>Initialize the <a class="el" href="classCommunication_1_1Timer.html" title="Class that provides functionality for the ATmega644&#39;s on-board 16-bit timer, such as an ISR.">Timer</a> &amp; <a class="el" href="classCommunication_1_1IOPin.html" title="Class that provides functionality for the ATmega644&#39;s PinB6, such as an ISR.">IOPin</a> class. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aef01d966bfe59d20e8c14bdd551bde2f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef01d966bfe59d20e8c14bdd551bde2f">&#9670;&nbsp;</a></span>getParity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bit_t Communication::getParity </td>
          <td>(</td>
          <td class="paramtype">byte_t&#160;</td>
          <td class="paramname"><em>byte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the parity of a <code>byte</code>. </p>
<p>Copied from <a href="https://stackoverflow.com/questions/21617970/how-to-check-if-value-has-even-parity-of-bits-or-odd">https://stackoverflow.com/questions/21617970/how-to-check-if-value-has-even-parity-of-bits-or-odd</a>. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">byte</td><td>( byte_t): Byte to calculate parity for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>( bit_t): The parity bit. </dd></dl>

</div>
</div>
<a id="a43cc003e21973368bf52ee6b21f5f26a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43cc003e21973368bf52ee6b21f5f26a">&#9670;&nbsp;</a></span>receiveByte()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">byte_t Communication::receiveByte </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Receive a single byte from the Terminal. </p>
<ol type="1">
<li>Set the direction to input (<a class="el" href="classCommunication_1_1IOPin.html#a61824b00597c9feeb27fb238289c06e6" title="Set the direction of the Pin.">IOPin::setDirection()</a>) &amp; enable interrupts for the <a class="el" href="classCommunication_1_1IOPin.html" title="Class that provides functionality for the ATmega644&#39;s PinB6, such as an ISR.">IOPin</a> (<a class="el" href="classCommunication_1_1IOPin.html#a7d5c9701e534b17979a0e95741647d7b" title="Enable/disable interrupts for the Pin.">IOPin::setInterrupt()</a>).</li>
<li>Set <a class="el" href="classCommunication.html#aa15f1c7805859e5e30e6dfa44fee4823" title="Whether a byte was received successfully.">mByteReceived</a> to false &amp; wait until it's true again.</li>
</ol>
<dl class="section return"><dt>Returns</dt><dd>( byte_t): The received byte </dd></dl>

</div>
</div>
<a id="aeb7e7185a93d4e683283f79a1ff05940"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb7e7185a93d4e683283f79a1ff05940">&#9670;&nbsp;</a></span>receiveDataToDecrypt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Communication::receiveDataToDecrypt </td>
          <td>(</td>
          <td class="paramtype">byte_t *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive data to decrypt from the Terminal. </p>
<ol type="1">
<li>Receive the protocol header, <a class="el" href="structProtocol.html#a183a9593e07df667c1f33b1bd09aed67" title="T=0 protocol header for incoming data to be decrypted.">Protocol::DATA_IN_HEADER</a>, by calling <a class="el" href="classCommunication.html#ad19417b90a477e7e37716d3a673ca2de" title="Receive a protocol header, which contains 5 bytes.">receiveProtocolHeader()</a>.</li>
<li>Receive 16 bytes of data byte-by-byte &amp; send <a class="el" href="structProtocol.html#ac1f57a3c765e2cebc8d1aada621a9b06" title="Acknowledge byte for instruction 0x10.">Protocol::ACK_DATA_IN</a> after each byte.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">data</td><td>( byte_t*): Byte array to store the received data in. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad19417b90a477e7e37716d3a673ca2de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad19417b90a477e7e37716d3a673ca2de">&#9670;&nbsp;</a></span>receiveProtocolHeader()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Communication::receiveProtocolHeader </td>
          <td>(</td>
          <td class="paramtype">const byte_t *&#160;</td>
          <td class="paramname"><em>header</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Receive a protocol header, which contains 5 bytes. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">header</td><td>(const byte_t*): Header to expect. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a530448e23dae916c63f5f82b5902e265"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a530448e23dae916c63f5f82b5902e265">&#9670;&nbsp;</a></span>sampleBit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bit_t Communication::sampleBit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sample the <a class="el" href="classCommunication_1_1IOPin.html" title="Class that provides functionality for the ATmega644&#39;s PinB6, such as an ISR.">IOPin</a> 3-times for a more reliable result. </p>
<dl class="section return"><dt>Returns</dt><dd>(bit_t): The sample value of the bit. </dd></dl>

</div>
</div>
<a id="ab53c6edcc0b9a2daf6950fcd0fc2db58"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab53c6edcc0b9a2daf6950fcd0fc2db58">&#9670;&nbsp;</a></span>sendATR()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Communication::sendATR </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Send the Answer-To-Reset sequence to the Terminal. </p>
<p>After the Reset-Pin is set to 1, send this sequence to initiate the transfer. </p>

</div>
</div>
<a id="ac9781e15d4a356d34a02feecc8c1515a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac9781e15d4a356d34a02feecc8c1515a">&#9670;&nbsp;</a></span>sendBit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Communication::sendBit </td>
          <td>(</td>
          <td class="paramtype">const bit_t&#160;</td>
          <td class="paramname"><em>bit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Send a single <code>bit</code> to the Terminal. </p>
<ol type="1">
<li>Wait for the last bit to be sent, (<a class="el" href="classCommunication.html#ac36a86c65f19bbac545e4351df3b0bff" title="Whether the last bit of a transmission was sent.">mBitSent</a> to be true).</li>
<li>Set <a class="el" href="classCommunication.html#acbde0b115b5640cd61be4f4fb66ede23" title="The next bit to output.">mOutputBit</a> to <code>bit</code>.</li>
<li>Set <a class="el" href="classCommunication.html#ac36a86c65f19bbac545e4351df3b0bff" title="Whether the last bit of a transmission was sent.">mBitSent</a> to false.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bit</td><td>(const bit_t): The bit to send. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="afee1d50aa5768c3d1e06ce1f57b8e44f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afee1d50aa5768c3d1e06ce1f57b8e44f">&#9670;&nbsp;</a></span>sendByte()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Communication::sendByte </td>
          <td>(</td>
          <td class="paramtype">const byte_t&#160;</td>
          <td class="paramname"><em>byte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Send a single <code>byte</code> to the Terminal. </p>
<ol type="1">
<li>Set the direction to output (<a class="el" href="classCommunication_1_1IOPin.html#a61824b00597c9feeb27fb238289c06e6" title="Set the direction of the Pin.">IOPin::setDirection()</a>) &amp; disable interrupts for the <a class="el" href="classCommunication_1_1IOPin.html" title="Class that provides functionality for the ATmega644&#39;s PinB6, such as an ISR.">IOPin</a> (<a class="el" href="classCommunication_1_1IOPin.html#a7d5c9701e534b17979a0e95741647d7b" title="Enable/disable interrupts for the Pin.">IOPin::setInterrupt()</a>).</li>
<li>Start the timer &amp; set the match value to 1 <a class="el" href="classCommunication_1_1Timer.html#a760d1a900f913fed3970b1aad5511702" title="The counter value which the timer should match.">Timer::ETU</a>.</li>
<li>Send the <a class="el" href="classCommunication.html#a0bb3e5432a3a6d32bb7271b9baeade93" title="The start bit of a transfer.">START_BIT</a>.</li>
<li>Send each bit of <code>byte</code> separately.</li>
<li>Calculate the parity (<a class="el" href="classCommunication.html#aef01d966bfe59d20e8c14bdd551bde2f" title="Calculate the parity of a byte.">getParity()</a>) &amp; send the parity bit.</li>
<li>Send the <a class="el" href="classCommunication.html#aea93e4f68298850c1e7c633360367f5c" title="The stop bit of a transfer.">STOP_BIT</a>.</li>
<li>After half an <a class="el" href="classCommunication_1_1Timer.html#a760d1a900f913fed3970b1aad5511702" title="The counter value which the timer should match.">Timer::ETU</a>, check if the <a class="el" href="classCommunication_1_1IOPin.html" title="Class that provides functionality for the ATmega644&#39;s PinB6, such as an ISR.">IOPin</a> is low, which indicates a parity error. If so, restart at 2.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">byte</td><td>(const byte_t): Byte to send. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4938d06e3b4f50f486f8e778cd8e4a2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4938d06e3b4f50f486f8e778cd8e4a2d">&#9670;&nbsp;</a></span>sendBytes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Communication::sendBytes </td>
          <td>(</td>
          <td class="paramtype">const byte_t *&#160;</td>
          <td class="paramname"><em>bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Send an array of <code>bytes</code> byte by byte. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">bytes</td><td>(const byte_t*): Array of bytes. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">len</td><td>(const uint8_t): Length of the array. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0d634219b224e9dbd6cc930d9a92ffd2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d634219b224e9dbd6cc930d9a92ffd2">&#9670;&nbsp;</a></span>sendDecryptedData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Communication::sendDecryptedData </td>
          <td>(</td>
          <td class="paramtype">const byte_t *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send the decrypted data to the Terminal. </p>
<ol type="1">
<li>Indicate that the decryption is done by sending <a class="el" href="structProtocol.html#a2921b144048162e0bf35a3294711728f" title="Response that is sent after the data to decrypt has been received.">Protocol::RESPONSE_DECRYPTED</a>.</li>
<li>Receive the protocol header, <a class="el" href="structProtocol.html#acfa3dc46a23b39cb47fe50b9e58f6023" title="T=0 protocol header for decrypted outgoing data.">Protocol::DATA_OUT_HEADER</a>, by calling <a class="el" href="classCommunication.html#ad19417b90a477e7e37716d3a673ca2de" title="Receive a protocol header, which contains 5 bytes.">receiveProtocolHeader()</a>.</li>
<li>Send <a class="el" href="structProtocol.html#aeffbe34561441d74eafb49a09c6751ce" title="Acknowledge byte for instruction 0xc0.">Protocol::ACK_DATA_OUT</a>.</li>
<li>Send each decrypted byte consequentially.</li>
<li>Indicate that the transfer of decrypted data is done, by sending <a class="el" href="structProtocol.html#a7b5368ccee99921ea9ad1b11945047e2" title="Response after sending the decrypted data.">Protocol::RESPONSE_DATA_OUT</a>.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>(const byte_t*): Decrypted byte array to send to the Terminal. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="communication_8h_source.html">communication.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
