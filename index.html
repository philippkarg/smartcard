<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ATmega644 Smart-Card: ATmega644 Smart-Card running AES decryption</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom-doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ATmega644 Smart-Card
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ATmega644 Smart-Card running <a class="el" href="classAES.html" title="Class providing functionality for 128-bit AES decryption.">AES</a> decryption </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1">Introduction</a></li>
<li class="level1"><a href="#autotoc_md3">Project Overview</a></li>
<li class="level1"><a href="#autotoc_md5">Build Configurations</a><ul><li class="level2"><a href="#autotoc_md6">Prerequisites</a></li>
<li class="level2"><a href="#autotoc_md7">Building the Project</a></li>
<li class="level2"><a href="#autotoc_md8">Debug Mode</a></li>
<li class="level2"><a href="#autotoc_md9">Countermeasures</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md11">Credits</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Introduction</h1>
<p>This repository contains an 128-bit <a class="el" href="classAES.html" title="Class providing functionality for 128-bit AES decryption.">AES</a> decryption algorithm, that runs on a Smart-Card with an AVR ATmega644 microcontroller on it. The code was implemented in the scope of a "Smart-Card Laboratory" at the Technical University of Munich, with the purpose to decrypt chunks of a video stream while communicating with a Smart-Card reader or Terminal. The communication between the Smart-Card an the Terminal occurs over the Smart-Card's ISO7816 I/O contact and follows the <em>T=0</em> protocol specified in ISO7816. This markdown page provides some information on build configurations &amp; gives an overview of the code.</p>
<hr  />
 <h1><a class="anchor" id="autotoc_md3"></a>
Project Overview</h1>
<p>The code for the clone consists of these main classes:</p>
<ul>
<li>The <code><a class="el" href="classCommunication.html" title="Class that implements the communication protocol between the SmartCard &amp; the Terminal.">Communication</a></code> class manages the <em>T=0</em> protocol to communicate with the Terminal.</li>
<li>The <code><a class="el" href="classAES.html" title="Class providing functionality for 128-bit AES decryption.">AES</a></code> class contains all the functionality required for the 128-bit <a class="el" href="classAES.html" title="Class providing functionality for 128-bit AES decryption.">AES</a> decryption running on the processor.</li>
<li>The <code><a class="el" href="classAESMath.html" title="Class providing some mathematical functions needed for AES.">AESMath</a></code> class contains some math helper functions for the decryption.</li>
<li>The <code><a class="el" href="classHiding.html" title="Class that implements 2 hiding techniques: dummy-ops &amp; shuffling.">Hiding</a></code> class implements countermeasures Shuffling &amp; Dummy-Ops.</li>
<li>The <code><a class="el" href="classMasking.html" title="Masking class that provides functionality for masking and unmasking AES-decryption.">Masking</a></code> class implements the <a class="el" href="classMasking.html" title="Masking class that provides functionality for masking and unmasking AES-decryption.">Masking</a> countermeasure.</li>
<li>The <code><a class="el" href="classRNG.html" title="Class that provides a random number generator. The RNG can be seeded by reading noise from an unused ...">RNG</a></code> class implements a small, lightweight Random-Number-Generator.</li>
<li>The <code><a class="el" href="classLogger.html" title="Logger class that outputs logs over USART.">Logger</a></code> class can be used to log message to a serial console over USART &amp; USB. Note that this functionality is only available in <em>debug mode</em>.</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md5"></a>
Build Configurations</h1>
<h2><a class="anchor" id="autotoc_md6"></a>
Prerequisites</h2>
<ul>
<li>This project uses CMake and requires Version <em>3.5</em> or higher.</li>
<li>If you want to flash the executable onto an ATmega644 yourself, make sure to install <code>avrdude</code> (e.g. on Debian: <code>sudo apt-get install avrdude</code>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Building the Project</h2>
<p>The repository is built using CMake. To build the default <code>.hex</code> file that can be flashed on the ATmega644 using an AVR programmer, do the following:</p>
<ul>
<li>Create a build directory: <code>$ mkdir build/</code></li>
<li>Change into the directory: <code>$ cd build/</code></li>
<li>Run CMake: <code>$ cmake ..</code></li>
<li>If you only want to compile the project, run: <code>$ make</code></li>
<li>If you also want to flash it onto an ATmega644, run: <code>$ make flash</code></li>
</ul>
<p>There are a couple of CMake options that can be turned on/off. To see a complete list of them, run: <code>$ cmake -L ..</code> from you build folder.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Debug Mode</h2>
<p>The Smart-Card used in this laboratory came with an USART to USB converter chip. This makes it possible to log messages to a serial console on a PC over the ATmega644's USART peripheral. If you are compiling this code for your own Smart-Card, you might run into issues with USART. To enable logging of debug messages, the project can be compiled in <em>debug mode</em>. Note that this greatly increases the executable size &amp; that some UART message might interfere with the Terminal communication. If these message are unwanted, the project can also be compiled in <em>release mode</em>.</p>
<ul>
<li>Run <code>$ cmake -DDebug=ON ..</code> to build the project in <em>debug mode</em>.</li>
<li>Run <code>$ cmake -DDebug=OFF ..</code> to build the project in <em>release mode</em>.</li>
<li>The default value is <code>OFF</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
Countermeasures</h2>
<p>The <a class="el" href="classAES.html" title="Class providing functionality for 128-bit AES decryption.">AES</a> implementation contains a number of DPA countermeasures, including <a class="el" href="classMasking.html" title="Masking class that provides functionality for masking and unmasking AES-decryption.">Masking</a>, Shuffling the S-Box access &amp; inserting Dummy NOPs. You can enable/disable these countermeasures with CMake flags:</p>
<ul>
<li><b><a class="el" href="classMasking.html" title="Masking class that provides functionality for masking and unmasking AES-decryption.">Masking</a></b>: When masking is enabled, the current 16-byte <a class="el" href="classAES.html" title="Class providing functionality for 128-bit AES decryption.">AES</a> state &amp; all round-keys, will be masked with 6 randomly generated masks. These masks will be applied once before the first round, re-applied after every inverse MixColumns operation &amp; removed after the last round. To enable/disable masking, do the following:<ul>
<li>Run <code>$ cmake -DMasking=ON ..</code> to enable masking.</li>
<li>Run <code>$ cmake -DMasking=OFF ..</code> to disable masking.</li>
<li>The default value is <code>OFF</code>.</li>
</ul>
</li>
<li><b>Shuffling</b>: Another countermeasure that was added is the shuffling of S-Box accesses. When reading values from the S-Box look-up table, these accesses are not performed in a specific order, but a random. The goal of this is to randomize the chips power consumption during decryption. To enable/disable Shuffling, do the following:<ul>
<li>Run <code>$ cmake -DShuffling=ON</code> to enable Shuffling.</li>
<li>Run <code>$ cmake -DShuffling=OFF</code> to disable Shuffling.</li>
<li>The default value is <code>OFF</code>.</li>
</ul>
</li>
<li><b>Dummy-Ops</b>: The last countermeasure that was implemented are Dummy NOPs. These are inserted before every <a class="el" href="classAES.html" title="Class providing functionality for 128-bit AES decryption.">AES</a> operation (AddRoundKey, InvMixCol, InvShiftRows, InvSubBytes) to also randomize the power consumption during decryption. To enable/disable Dummy-Ops do the following:<ul>
<li>Run <code>$ cmake -DDummyOps=ON</code> to enable Dummy-Ops.</li>
<li>Run <code>$ cmake -DDummyOps=OFF</code> to disable Dummy-Ops.</li>
<li>The default value is <code>OFF</code>.</li>
</ul>
</li>
</ul>
<hr  />
 <h1><a class="anchor" id="autotoc_md11"></a>
Credits</h1>
<p>The Doxygen custom CSS template used in this project can be found <a href="https://github.com/jothepro/doxygen-awesome-css" target="_blank">here</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
